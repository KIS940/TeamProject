<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/fonts.css}">
    <link rel="stylesheet" th:href="@{/css/post2.css}">
    <title>GAXGA</title>
</head>
<body>
<th:block th:replace="~{public/layouts/header2 :: header}"></th:block>
<div class="wrap">
    <div class="post-result">
        <div class="review-title">
            <h2>가봤다고</h2>
            <p>후기 게시글 작성</p>
        </div>
        <div th:object="${gabowatdago}">
            <form action="/gabowatdago/update" method="POST" id="myForm" enctype="multipart/form-data">
                <input name="id" type="hidden" th:value="*{id}">
                <div class="review-name">
                    <input name="title" type ="text" maxlength="40" th:value="*{title}">
                </div>
                <div id="line"></div>
                <div class="select">
                    <div class="local" style="width: 20%;">
                        <select name="local" class="custom-select">
                                <option selected>지역</option>
                                <option th:each ="locations: ${locList}" th:text="${locations}"></option>
                            </select>
                    </div>
                    <div class="tema" style="width: 20%";>
                        <!--                    <label>테마 선택:</label>-->
                        <select name="thema" class="custom-select">
                            <option selected>테마</option>
                            <option th:each ="themas: ${themaList}" th:text="${themas}">산</option>
                        </select>
                    </div>
                    <div class="date" style="width: 60%; text-align: right">
                    </div>
                </div>
                <div class="file-area">
                    <div class="file-input" style="width: 50%;">
                        <label> 여행지 사진 첨부 </label>
                        <div class="input-group mb-3">
                            <input type="file" class="form-control" id="inputGroupFile03"
                                   multiple accept="image/*" name="image">
                        </div>
                    </div>
                    <input class="writer" style="width: 50%; text-align: right;" th:placeholder="${userNick}" readonly>
                    <input name="gaId" th:value="${gaId}" style="display: none">
                </div>
                <div id="uploadedImages" style="margin-top: 20px;"></div>
                <div id="textContent">
                    <textarea name="content" id="content" cols="130" rows="20" class="form-control" th:text="*{content}"></textarea>
                </div>
                <div id="address_Area">
                    <label for="address"><a id="addressA">여행지 주소</a></label>
                    <div class="input-group mb-3" style="margin: 0 0 10px 10px;">
                        <button class="btn btn-outline-secondary" type="button" id="button-addon1" onclick="sample5_execDaumPostcode()">주소 검색</button>
                        <input type="text" name="address"  id="sample5_address" class="form-control" placeholder="주소" aria-label="Example text with button addon" aria-describedby="button-addon1" th:value="*{address}">
                        <input type="text" name="de_address" id="sample5_detailAddress" class="form-control" placeholder="상세주소를 입력해주세요!" aria-label="Example text with button addon" aria-describedby="button-addon1" th:value="*{de_address}">
                    </div>
                </div>
                <div id="map"></div>
                <input type="hidden" id="road_latitude" th:value="*{lat}">
                <input type="hidden" id="road_longitude" th:value="*{lng}">
                <input type="hidden" name="lat" id="latitude">
                <input type="hidden" name="lng" id="longitude">
                <input type="hidden" name="likeCount" th:value="*{likeCount}">
                <div id="submit_Area">
                    <button style="float: right; margin-top: 5px; margin-bottom: 20px" type="submit" id="submitButton" class="btn btn-secondary" >게시하기</button>
                </div>
                <a href="/gabowatdago/{{id}}">돌아가기</a>
            </form>
        </div>
    </div>
</div>
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=6d7e2f086ffa97eb8f4b35fa8cc12439&libraries=services"></script>
<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="/js/post_edit.js"></script>
<script src="/js/menu.js"></script>
<script>
    var today = new Date();
    const date = document.querySelector(".date");
    var year = today.getFullYear();
    var month = ('0' + (today.getMonth() + 1)).slice(-2);
    var day = ('0' + today.getDate()).slice(-2);

    var dateString = year + '-' + month  + '-' + day;

    date.innerText = `${dateString}`;
</script>
<script>
    const filesArray = [];

    document.getElementById('inputGroupFile03').addEventListener('change', function(event) {
        const newFiles = Array.from(event.target.files);
        const uploadedImagesDiv = document.getElementById('uploadedImages');
        const fileInput = event.target;

        newFiles.forEach((file, index) => {
            filesArray.push(file);
            const reader = new FileReader();

            reader.onload = function(e) {
                const imgContainer = document.createElement('div');
                imgContainer.style.display = 'inline-block';
                imgContainer.style.position = 'relative';
                imgContainer.style.margin = '10px';

                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.maxWidth = '200px';

                const deleteButton = document.createElement('button');
                deleteButton.innerText = '삭제';
                deleteButton.style.position = 'absolute';
                deleteButton.style.top = '5px';
                deleteButton.style.right = '5px';
                deleteButton.style.backgroundColor = 'red';
                deleteButton.style.color = 'white';
                deleteButton.style.border = 'none';
                deleteButton.style.borderRadius = '3px';
                deleteButton.style.cursor = 'pointer';

                deleteButton.addEventListener('click', function() {
                    uploadedImagesDiv.removeChild(imgContainer);
                    const fileIndex = filesArray.indexOf(file);
                    if (fileIndex > -1) {
                        filesArray.splice(fileIndex, 1);
                    }
                    updateFileInput(filesArray, fileInput);
                });

                imgContainer.appendChild(img);
                imgContainer.appendChild(deleteButton);
                uploadedImagesDiv.appendChild(imgContainer);
            };

            reader.readAsDataURL(file);
        });

        updateFileInput(filesArray, fileInput);
    });

    function updateFileInput(files, fileInput) {
        const dataTransfer = new DataTransfer();
        files.forEach(file => dataTransfer.items.add(file));
        fileInput.files = dataTransfer.files;
    }
</script>
</body>
</html>