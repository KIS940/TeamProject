<div th:include="layouts/header"></div>
<link rel="stylesheet" th:href="@{/css/post_result_.css}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

<div th:object="${gabowatdago}">
    <div class="Waarea">
      <div class="Waleft">
        <div class="Waname">가봤다고</div>
        <div class="Waprofile">
          <div class="WaprofileA">
            <div class="Waimg-area">
              <div><img src="../img/cata.png" class="Waimg" alt=""></div>
            </div>
            <div class="Walist">
              <div>list1</div>
              <div>list2</div>
              <div>list3</div>
            </div>
          </div>
          <div class="WaprofileB">
            <div class="Wausername"></div>
            <div class="Waemail"></div>
          </div>
        </div>
        <div class="intro">
          <div>님! 비슷한 여행지를 추천드려요</div>
        </div>
        <div class="review-list-box">
          <div class="review-list">
            <div class="review-image">
              <img src="../img/wolmido.png">
            </div>
            <div class="review-info">
              <div class="review-name"><a href="#">월미도</a></div>
              <div class="review-address"><a href="#">안산시 단원구 와동 황금길</a></div>
            </div>
          </div>
          <div class="review-list">
            <div class="review-image">
              <img src="../img/wolmido.png">
            </div>
            <div class="review-info">
              <div class="review-name"><a href="#">월미도</a></div>
              <div class="review-address"><a href="#">안산시 단원구 와동 황금길</a></div>
            </div>
          </div>
          <div class="review-list">
            <div class="review-image">
              <img src="../img/wolmido.png">
            </div>
            <div class="review-info">
              <div class="review-name"><a href="#">월미도</a></div>
              <div class="review-address"><a href="#">안산시 단원구 와동 황금길</a></div>
            </div>
          </div>
          <div class="review-list">
            <div class="review-image">
              <img src="../img/wolmido.png">
            </div>
            <div class="review-info">
              <div class="review-name"><a href="#">월미도</a></div>
              <div class="review-address"><a href="#">안산시 단원구 와동 황금길</a></div>
            </div>
          </div>
          <div class="review-list">
            <div class="review-image">
              <img src="../img/wolmido.png">
            </div>
            <div class="review-info">
              <div class="review-name"><a href="#">월미도</a></div>
              <div class="review-address"><a href="#">안산시 단원구 와동 황금길</a></div>
            </div>
          </div>
          <div class="review-list">
            <div class="review-image">
              <img src="../img/wolmido.png">
            </div>
            <div class="review-info">
              <div class="review-name"><a href="#">월미도</a></div>
              <div class="review-address"><a href="#">안산시 단원구 와동 황금길</a></div>
            </div>
          </div>
          <div class="review-list">
            <div class="review-image">
              <img src="/img/wolmido.png">
            </div>
            <div class="review-info">
              <div class="review-name"><a href="#">월미도</a></div>
              <div class="review-address"><a href="#">안산시 단원구 와동 황금길</a></div>
            </div>
          </div>
          <div class="review-list">
            <div class="review-image">
              <img src="/img/wolmido.png">
            </div>
            <div class="review-info">
              <div class="review-name"><a href="#">월미도</a></div>
              <div class="review-address"><a href="#">안산시 단원구 와동 황금길</a></div>
            </div>
          </div>
        </div>
      </div>
      <div class="Waright">
        <div class="post-result">
          <div class="title-box" style="height: 15%">
            <div class="post-title" th:text="*{title}"></div>
          </div>
          <div class="intro-area">
          <div class="post-info">
              <div class="date">
                게시날짜:
                <span>0418</span>
              </div>
              <div class="loctag">
                <div class="loc" th:text="*{local}">
                </div>
                <div class="tag">
                  여행 태그:<span>
                    <a href="">#인천</a>
                    <a href="">#테마파크</a>
                    <a href="">#월미도</a>
                  </span>
                </div>
              </div>
            </div>
            <div class="delete">
              <div class="like">
                이 게시글은 명에게 추천받았습니다.
              </div>
              <div>
                <input type="button" class="btn btn-outline-success" value="목록 보기" style="width: 15%; line-height: 0.6;" onclick="window.location.href='/gabowatdago'">
                <a th:href="@{'/gabowatdago/' + ${id} + '/edit'}"><input type="button" value="수정" style="line-height: 0.6;" class="btn btn-outline-success"></a>
                <a th:href="@{'/gabowatdago/' + ${id} + '/delete'}"><input type="button" value="삭제" style="line-height: 0.6;" class="btn btn-outline-danger" onclick="delOk()" ></a>
              </div>
            </div>
          </div>
          <div class="main-box">
            <div class="image-box">
              <div class="slider__wrap">
                <div class="slider__img">{{image}}</div>
                <div class="slider__thumb"></div>
                <div class="slider__btn">
                    <a href="#" class="prev" title="이전이미지">&lang;</a>
                    <a href="#" class="next" title="다음이미지">&rang;</a>
                </div>
            </div>
            </div>
            <div class="text-box" th:text="*{content}">
            </div>
               <h3>여행지 주소</h3><br>
              <div style="font-family: GmarketSans; color:#6A6A6A" th:text="*{address}"> </div>
              <div style="font-family: GmarketSans; color:#6A6A6A" th:text="*{de_address}"></div>
            <div id="maps"></div>

            <div class="comment-container">
              <div class="input-box">
              <form class="comment-input">
                <input style ="width: 20%;" id="client" type ="text" maxlength="10" placeholder="닉네임">
                <textarea style ="width: 80%;" id="comment" type ="text" placeholder="작성자에게 댓글을 남겨주세요"></textarea>
                <input type="hidden" id="new-comment-gabowatdago_id" th:value="*{id}">
                <input id="comment-save" type="submit" value="댓글 작성">
              </form>
              </div>
              <div class="comment-list-box">
                <div class="card" th:each="cmt :${cmtDtos}" style="margin: 10px">
                  <h5 class="card-header"  style="display: flex;">
                    <span th:text="${cmt.nickname}"></span>
                    <div>
                      <!-- Button trigger modal -->
                      <button type="button"
                              style="line-height: 0.5;"
                              id="updateBtn"
                              class="btn btn-outline-success"
                              data-bs-toggle="modal"
                              th:data-bs-target="${cmt.id}"
                              >수정</button>
                    <button type="button" style="line-height: 0.5;" class="btn btn-outline-danger" id="deleteBtn"
                            th:data-comment-id="${cmt.id}">삭제</button>
                    </div>
                  </h5>
                  <div class="card-body">
                    <p class="card-title" th:text="${cmt.body}"></p>
                  </div>
                  <!-- Modal -->
                  <div class="modal fade" th:id="${cmt.id}" tabindex="-1">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          ...
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
          </div>
      </div>
      </div>
    </div>
      </div>
    </div>
  </div>


<script>
  // 삭제버튼 클릭 알림창
  function delOk(){
    if(!confirm('삭제하시면 복구할수 없습니다. \n 정말로 삭제하시겠습니까??')){
      return false;
    }
  }
  // 댓글  작성 기능
  const commentCreateBtn = document.querySelector("#comment-save")

  commentCreateBtn.addEventListener("click",function (){
    //새 댓글 객체 생성
    const comment = {
      nickname: document.querySelector("#client").value,
      body: document.querySelector("#comment").value,
      gabowatdagoId: document.querySelector("#new-comment-gabowatdago_id").value
    };
    //댓글 객체 출력해보기
    console.log(comment);
    const url = "/api/gabowatdago/"+ comment.gabowatdagoId+"/cmts";
    fetch(url, {
      method: "POST",
      headers : {  //전송 본문의 데이터 타입 (json) 정보
        "Content-Type" : "application/json"
      },
      body: JSON.stringify(comment) //comment 객체를 json 문자열로 변환해 전송
    }).then(response =>{
      //http 응답 코드에 따른 메시지 출력해주기
      const msg = (response.ok) ? "댓글 등록 완료" : "댓글 등록 실패";
      alert(msg);
      // 새로고침
      window.location.reload();
    })
  });
  //댓글 수정
  // const commentUpdateBtns = document.querySelector("#updateBtn")
  // commentUpdateBtns.forEach(btn =>{
  //   btn.addEventListener("click", (event)=>{
  //     const commentUpdateBtn = event.target;
  //     const commentId = commentUpdateBtn.getAttribute("data-bs-target");
  //     console.log(`수정버튼 클릭 : ${commentId}번 댓글`)
  //   })
  // })
  //댓글 삭제
  const commentDeleteBtns = document.querySelectorAll("#deleteBtn")
  //삭제 버튼 이벤트 처리
  commentDeleteBtns.forEach(btn => {
    btn.addEventListener("click", (event) =>{ //이벤트 객체 받아와서
      // 이벤트 발생 요소 선택
      const commentDeleteBtn = event.target; //삭제 버튼 변수화
      //삭제 댓글 id 가져오기
      const commentId = commentDeleteBtn.getAttribute("data-comment-id");
      console.log(`삭제 버튼 클릭 : ${commentId}번 댓글`);
      //삭제 REST API 호출
      const url = `/api/cmts/${commentId}`
      fetch(url, {
        method: "DELETE"
      }).then(response => {
        //댓글 삭제 실패 처리
        if(!response.ok){
          alert("댓글 삭제 실패");
          return;
        }
        const msg = "댓글 삭제 완료";
        alert(msg);
        window.location.reload();
      })
    });
  });
</script>
<script th:src="@{/js/post_result.js}"></script>
<script th:src="@{'//dapi.kakao.com/v2/maps/sdk.js?appkey=6d7e2f086ffa97eb8f4b35fa8cc12439&libraries=services'}"></script>

<script src="/js/menu.js"></script>

</body>
</html>